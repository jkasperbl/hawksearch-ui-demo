<!DOCTYPE html>
<html lang="en">
    <head>
        <script type="text/javascript">
            var HawkSearch = HawkSearch || {};

            HawkSearch.config = {
                clientId: 'bc841843aa494dea87f0a1ce48463fe3',
                autocomplete: {
                    fieldMappings: {
                        price: 'price_retail',
                        rating: 'rating',
                        salePrice: 'price_sale'
                    }
                },
                search: {
                    url: window.location.pathname,
                    fieldMappings: {
                        imageUrl: 'image',
                        title: 'name',
                        price: 'price_retail',
                        rating: 'rating',
                        salePrice: 'price_sale',
                        type: 'it',
                        url: 'url_detail'
                    }
                },
                css: {
                    customStyles: window.location.origin + window.location.pathname.replace(/\/[^/]+.html/, '/') + 'hawksearch.css'
                },
                seo: {
                    title: {
                        suffix: ' | Plant Addicts'
                    }
                },
                components: {
                    'search-field': {
                        strings: {
                            placeholder: 'Search for Plants...'
                        }
                    }
                }
            };

            addEventListener('hawksearch:after-search-executed', (event) => {
                const searchResponse = event.detail;
                const title = searchResponse.Name;

                searchResponse.HeaderTitle = title;
                searchResponse.PageHeading = title;
            });

            addEventListener('hawksearch:search-completed', (event) => {
                const searchResponse = event.detail;
                const title = getTitle(searchResponse);

                searchResponse.seo.title = title;
                searchResponse.content.heading = title;

                updateSeoValues(searchResponse);
            });

            document.addEventListener('readystatechange', (event) => {
                if (event.target.readyState !== 'complete') {
                    return;
                }

                const h1Tag = document.querySelector('h1');

                if (h1Tag) {
                    h1Tag.style.display = 'none';
                }
            });

            window.addEventListener('popstate', (event) => {
                const state = event.state;
                const searchResponse = state.searchResponse;

                updateSeoValues(state.searchResponse);
            });

            function getTitle(searchResponse) {
                let title = searchResponse.seo.title;
                const displayedFacets = [];
                const selectedValues =
                    searchResponse.selectedFacets
                        ?.filter((f) => !displayedFacets.length || displayedFacets.includes(f.field))
                        .flatMap((f) => f.values)
                        .map((f) => f.title) ?? [];

                if (selectedValues.length) {
                    let formattedValues;

                    if (selectedValues.length <= 2) {
                        formattedValues = selectedValues.join(' and ');
                    } else {
                        const lastValue = selectedValues.length > 2 ? selectedValues.splice(selectedValues.length - 1)[0] : undefined;

                        formattedValues = selectedValues.join(', ') + (lastValue ? `, and ${lastValue}` : '');
                    }

                    title = `${formattedValues} ${title}`;
                }

                return title;
            }

            function updateSeoValues(searchResponse) {
                HawkSearch.services.search.setSeoElements(searchResponse);

                if (searchResponse.content?.heading) {
                    const h1Tag = document.querySelector('h1');

                    if (!h1Tag) {
                        return;
                    }

                    let heading = searchResponse.content.heading;

                    h1Tag.innerHTML = heading;
                    h1Tag.style.display = 'block';
                }
            }
        </script>
        <script src="//cdn.jsdelivr.net/npm/@bridgeline-digital/hawksearch-handlebars-ui@4.0.1/dist/index.js" defer></script>
    </head>
    <body>
        <h1>H1 generated by BigCommerce</h1>
        <hawksearch-landing-page url="/test-hawk-category/"></hawksearch-landing-page>
        <template id="landing-page-template">
            {{#if customLayout}} {{html customLayout}} {{else}} {{#if (and content content.customHtml)}} {{html content.customHtml}} {{/if}}
            <hawksearch-search-results mode="landing-page" url="{{url}}"></hawksearch-search-results>
            {{/if}}
        </template>
    </body>
</html>
